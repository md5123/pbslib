#
# YLmf_OS package build script
#

DESCRIPTION="An interpreter for the PostScript language"
HOMEPAGE="http://www.ghostscript.com/"
LICENSE="GPLv3 custom"
PACKAGER="Ylmf OS Developers <ylmfos@115.com>"

SRC_URI="http://downloads.ghostscript.com/public/"$N-$V".tar.gz"

RDEPEND="atk avahi cairo cups dbus e2fsprogs expat fontconfig freetype gcc gdk-pixbuf glib2 glibc gnutls gtk+ jasper keyutils krb5 libgcrypt libgpg-error libICE libidn libjpeg-turbo libpng libSM libtasn1 libtiff libX11 libXau libxcb libXcomposite libXcursor libXdamage libXdmcp libXext libXfixes libXi libXrandr libXrender libXt pango pixman util-linux-ng zlib"
BDEPEND=""
RECOMMENDED=""
CONFLICT="gnu-ghostscript"

pbs_unpack() {
        ypkg_unpack
}

pbs_config() {
	# Force it to use system-libs
	rm -rf jpeg libpng zlib jasper expat tiff
	#
	YPB_CONFIG+="--enable-dynamic
	             --with-ijs
		     --with-jbig2dec
		     --with-omni
		     --with-x
		     --with-drivers=ALL
		     --with-fontpath=/usr/share/fonts/Type1:/usr/share/fonts
		     --disable-compile-inits" # needed for linking with system-zlib
	ypkg_config
} 

pbs_build() {
	ypkg_make
	
	# Build IJS
	cd ijs
	./autogen.sh
	./configure --prefix=/usr --enable-shared --disable-static
	ypkg_make
	cd -
}

pbs_install() {
	ypkg_mkinstall cups_serverroot="$YPPATH_DEST"/etc/cups \
	               cups_serverbin="$YPPATH_DEST"/usr/lib/cups soinstall
	ypkg_dodoc doc/{Ps2ps2.htm,gs-vms.hlp,gsdoc.el,pscet_status.txt} LICENSE
	
	# Install IJS
	cd ijs
	ypkg_mkinstall
}

