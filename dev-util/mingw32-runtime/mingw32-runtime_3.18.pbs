#
# YLmf_OS package build script
#

DESCRIPTION="mingw32 run-time library"
HOMEPAGE="http://www.mingw.org/"
LICENSE="LGPL"
PACKAGER="<ylmfos@115.com>"

SRC_URI="http://nchc.dl.sourceforge.net/project/mingw/MinGW/BaseSystem/RuntimeLibrary/MinGW-RT/mingwrt-3.18/mingwrt-3.18-mingw32-src.tar.gz"

RDEPEND=""
BDEPEND="mingw32-w32api"
RECOMMENDED=""

NOTES=""

pbs_unpack() {
        ypkg_unpack
}

pbs_config() {
	 sed -i "s%\r%%g" `find . -type f`
	 sed -i -e "s%^W32API_INCLUDE=.*%W32API_INCLUDE=-I/usr/i486-mingw32/include%" `find -type f -name 'configure'`
	 #unset CFLAGS CXXFLAGS CC CXX
	 export CFLAGS="-mms-bitfields"
	 ./configure \
	 	 --prefix=/usr/i486-mingw32 \
	 	 --target=i486-mingw32 \
		 --host=i486-mingw32 \
		 --build=$CHOST
}

pbs_build() {
	make
}

pbs_install() {
	mkdir -p "$YPPATH_DEST"/usr/i486-mingw32/bin
	make install prefix="$YPPATH_DEST"/usr/i486-mingw32
	cd "$YPPATH_DEST"
	rm -rf usr/i486-mingw32/{doc,man}
	find . -name '*.a' | xargs -rtl1 i486-mingw32-strip -g
}
