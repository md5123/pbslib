#
# YLmf_OS package build script
#

DESCRIPTION="GRand Unified Bootloader, version 2 with Ubuntu patchs"
HOMEPAGE="http://www.gnu.org/software/grub/grub-2.en.html"
LICENSE="GPL-2"
PACKAGER="<ylmfos@115.com>"
REPO="testing"

PRIORITY="required"

SRC_URI="http://ftp.csie.ncu.edu.tw/pub/Linux/Ubuntu/pool/main/g/grub2/grub2_1.99~rc1.orig.tar.gz"

RDEPEND="freetype glibc zlib"
BDEPEND="autogen"
RECOMMENDED=""
CONFLICT="grub"

INSTALL="$N.install"

NOTES=""

pbs_unpack() {
        ypkg_unpack
}

pbs_config() {
	patches="  
		olpc_prefix_hack.patch
		core_in_fs.patch
		dpkg_version_comparison.patch
		boot_blocklist_hack.patch
		grub_legacy_0_based_partitions.patch
		disable_floppies.patch
		grub.cfg_400.patch
		gfxpayload_keep_default.patch
		mkrescue_diet.patch
		mkconfig_skip_dmcrypt.patch
		install_stage2_confusion.patch
		qemu_img_exists.patch
		mountinfo_move_mounts.patch
		branch_butter.patch
		branch_devmapper.patch
		branch_squash.patch
		branch_longlinuxcmd.patch
		branch_parse-color.patch
		branch_embed-sectors.patch
		branch_fuse.patch
		btrfs_rootflags.patch
		lnxboot_grub.patch
		normal_menu_line_alloc.patch
		freebsd_module_header_alloc.patch
		video_fb_pageflip.patch
		freebsd_definitions.patch
		kfreebsd_libgeom.patch
		copy_partition_table.patch
		ext2_overflow.patch
		mdraid1x_raid0_size.patch
		mdraid1x_super_offset.patch
		host_optimise_flush.patch
		mkimage_yeeloong.patch
		loopback_replace.patch
		btrfs_reserved_sector.patch
		mkrescue_efi_modules.patch
		mips_initrd_limits.patch
		ubuntu_grub_standards.patch
		ubuntu_crashkernel.patch
		ubuntu_quick_boot.patch
		ubuntu_sleep_shift.patch
		ubuntu_normal_quiet.patch
		ubuntu_really_quiet.patch
		ubuntu_linux_quiet.patch
		ubuntu_handle_loopback.patch
		ubuntu_linux_no_loopmount.patch
		ubuntu_failed_boot_menu.patch
		ubuntu_no_device_map.patch
		ubuntu_quiet_grub_loading.patch
		ubuntu_lvm_raid_probe.patch
		ubuntu_langpacks.patch
		ubuntu_gfxpayload_filter.patch
		ubuntu_linux_submenus.patch
		ubuntu_vt_handoff.patch
		ubuntu_vbe_autodetect.patch
		ubuntu_blacklist_1440x900x32.patch
		ubuntu_64bit_div.patch
		ubuntu_btrfs_huge_chunk.patch
		ubuntu_16bit_relocator_sp.patch
		ubuntu_x86_64_efi.patch "
	ypkg_patch $patches
	YPB_CONFIG+=""
	./autogen.sh
	./configure $YPB_CONFIG
}

pbs_build() {
	ypkg_make
}

pbs_install() {
	ypkg_mkinstall
	ypkg_dodoc AUTHORS ChangeLog COPYING INSTALL NEWS README
	cd "$YPPATH_DEST"
	ypkg_docp "$FILES_PATH"/files/{update-grub2,update-grub}  usr/sbin
	ypkg_docp "$FILES_PATH"/files/grub  etc/default
	mv usr/sbin/grub-install{,.real}
}

