Description: Handle special naming of yeeloong directory
Author: Vladimir Serbinenko <phcoder@gmail.com>
Bug-Debian: http://bugs.debian.org/620420
Forwarded: yes
Applied-Upstream: http://bazaar.launchpad.net/~vcs-imports/grub/grub2-bzr/revision/3194
Last-Update: 2011-04-09

Index: b/util/grub-mkimage.c
===================================================================
--- a/util/grub-mkimage.c
+++ b/util/grub-mkimage.c
@@ -1586,9 +1586,19 @@
 		     + 1);
       memcpy (dir, GRUB_PKGLIBROOTDIR, sizeof (GRUB_PKGLIBROOTDIR) - 1);
       *(dir + sizeof (GRUB_PKGLIBROOTDIR) - 1) = '/';
-      memcpy (dir + sizeof (GRUB_PKGLIBROOTDIR), image_target->name,
-	      last - image_target->name);
-      *(dir + sizeof (GRUB_PKGLIBROOTDIR) + (last - image_target->name)) = 0;
+      if (strncmp (image_target->name, "mipsel-yeeloong",
+		   last - image_target->name) == 0)
+	{
+	  memcpy (dir + sizeof (GRUB_PKGLIBROOTDIR), "mips-yeeloong",
+		  sizeof ("mips-yeeloong"));	  
+	}
+      else
+	{
+	  memcpy (dir + sizeof (GRUB_PKGLIBROOTDIR), image_target->name,
+		  last - image_target->name);
+	  *(dir + sizeof (GRUB_PKGLIBROOTDIR) + (last - image_target->name))
+	    = 0;
+	}
     }
 
   generate_image (dir, prefix ? : DEFAULT_DIRECTORY, fp,
