Description: Disable gfxpayload=keep by default
 Setting gfxpayload=keep has been known to cause efifb to be inappropriately
 enabled.  In any case, with the current Linux kernel the result of this
 option is that early kernelspace will be unable to print anything to the
 console, so (for example) if boot fails and you end up dumped to an
 initramfs prompt, you won't be able to see anything on the screen.  As such
 it shouldn't be enabled by default in Debian, no matter what kernel options
 are enabled.
 .
 gfxpayload=keep is a good idea but rather ahead of its time ...
Author: Colin Watson <cjwatson@debian.org>
Bug-Debian: http://bugs.debian.org/567245
Forwarded: no
Last-Update: 2010-03-09

diff -Nur -x '*.orig' -x '*~' grub2/util/grub.d/10_linux.in grub2.new/util/grub.d/10_linux.in
--- grub2/util/grub.d/10_linux.in	2010-03-09 11:35:45.000000000 +0000
+++ grub2.new/util/grub.d/10_linux.in	2010-03-09 11:37:18.000000000 +0000
@@ -64,16 +64,7 @@
   printf "menuentry \"${title}\" ${CLASS} {\n" "${os}" "${version}"
   save_default_entry | sed -e "s/^/\t/"
 
-  # Use ELILO's generic "efifb" when it's known to be available.
-  # FIXME: We need an interface to select vesafb in case efifb can't be used.
-  if [ "x$GRUB_GFXPAYLOAD_LINUX" = x ]; then
-      if grep -qx "CONFIG_FB_EFI=y" /boot/config-${version} 2> /dev/null \
-	  && grep -qx "CONFIG_VT_HW_CONSOLE_BINDING=y" /boot/config-${version} 2> /dev/null; then
-	  cat << EOF
-	set gfxpayload=keep
-EOF
-      fi
-  else
+  if [ "x$GRUB_GFXPAYLOAD_LINUX" != x ]; then
 	  cat << EOF
 	set gfxpayload=$GRUB_GFXPAYLOAD_LINUX
 EOF
