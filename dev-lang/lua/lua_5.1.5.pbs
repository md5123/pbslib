#
# StartOS package build script
#
# Copyright 2012 StartOS
# Distributed under the terms of the GNU General Public License v2
#

DESCRIPTION="A powerful light-weight programming language designed for extending applications"
HOMEPAGE="http://www.lua.org/docs.html"
LICENSE="MIT"
PACKAGER="Zhongxin Huang <huangzhongxin@ivali.com>"
 
SRC_URI="http://www.lua.org/ftp/"$N-$V".tar.gz"
CHECKSUM="2e115fe26e435e33b0d5c022e4490567"

RDEPEND="readline"
BDEPEND=""

pbs_unpack() {
    dounpack
}

pbs_patch() {
    dopatch lua-arch.patch lua-5.1-cflags.diff
}

pbs_build() {
    [ "$ARCH" == "x86_64" ] && export CFLAGS="$CFLAGS -fPIC"
    domake linux MYCFLAGS=\"$CFLAGS\" MYLDFLAGS=\"$LDFLAGS\"
    sed "s/%VER%/${V%.*}/g;s/%REL%/$V/g;s/%LIBDIRSUFFIX%/$LIBDIRSUFFIX/g" "$filesdir"/lua.pc >lua.pc
}

pbs_install() {
    make TO_LIB="liblua.a liblua.so liblua.so.5.1" \
         INSTALL_DATA="cp -d" \
         INSTALL_TOP="$destdir"/usr \
         INSTALL_INC="$destdir"/usr/include/lua \
         INSTALL_LIB="$destdir"/usr/lib"$LIBDIRSUFFIX" \
         INSTALL_MAN="$destdir"/usr/share/man/man1 \
    install
    docp lua.pc "$destdir"/usr/lib"$LIBDIRSUFFIX"/pkgconfig/
    rm -rf "$destdir"/usr/lib/
}

