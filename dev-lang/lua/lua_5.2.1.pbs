#
# StartOS package build script
#
# Copyright 2012 StartOS
# Distributed under the terms of the GNU General Public License v2
#

DESCRIPTION="A powerful light-weight programming language designed for extending applications"
HOMEPAGE="http://www.lua.org/docs.html"
LICENSE="MIT"
PACKAGER="StartOS Developers"
 
SRC_URI="http://www.lua.org/ftp/"$N-$V".tar.gz"

RDEPEND="readline"
BDEPEND=""

pbs_unpack() {
    dounpack
}

pbs_patch () {
    dopatch liblua.so.patch
}

pbs_build() {
	[ "$ARCH" == "x86_64" ] && export CFLAGS="$CFLAGS -fPIC"
	domake linux MYCFLAGS=\"$CFLAGS\" MYLDFLAGS=\"$LDFLAGS\"
    sed "s/%VER%/${V%.*}/g;s/%REL%/$V/g;s/%LIBDIRSUFFIX%/$LIBDIRSUFFIX/g" "$filesdir"/lua.pc >lua.pc
}

pbs_install() {
	make TO_LIB="liblua.a liblua.so liblua.so.5.2 liblua.so.$V" \
         INSTALL_DATA="cp -d" \
         INSTALL_TOP="$destdir"/usr \
         INSTALL_INC="$destdir"/usr/include/lua5.2 \
         INSTALL_LIB="$destdir"/usr/lib"$LIBDIRSUFFIX" \
         INSTALL_MAN="$destdir"/usr/share/man/man1 \
    install
    docp lua.pc "$destdir"/usr/lib"$LIBDIRSUFFIX"/pkgconfig/

    cd "$destdir"/usr/
    rmdir -p lib/lua/"${V%.?}"
}

