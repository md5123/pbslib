#
# Ylmf OS package build script
#

DESCRIPTION="Larry Wall's Practical Extraction and Report Language"
HOMEPAGE="http://www.perl.org/"
LICENSE="GPL, PerlArtistic"
PACKAGER="Ylmf OS Developers <ylmfos@115.com>"

SRC_URI="http://www.cpan.org/src/5.0/"$N-$V".tar.bz2"

RDEPEND="berkeley-db gdbm glibc zlib"
BDEPEND=""

pbs_unpack() {
        dounpack
}

pbs_config() {
	# Builds the Compress::Raw::Zlib module. 
	# By default Perl will use an internal copy of the Zlib source 
	# for the build. Issue the following command so that Perl 
	# will use the Zlib library installed on the system: 
	sed -i -e '/^BUILD_ZLIB/s/True/False/' \
	       -e '/^INCLUDE/s,\./zlib-src,/usr/include,' \
       	       -e '/^LIB/s,\./zlib-src,/usr/lib'"$LIBDIRSUFFIX"',' \
       	       cpan/Compress-Raw-Zlib/config.in	
	
	# There is a further (possibly cosmetic) anomaly - if we install perl and then run perl -V it will claim that libc is in /lib.
	sed -i "/libc/s@/lib@/lib'"$LIBDIRSUFFIX"'@" hints/linux.sh

	# We still need to tell perl to actually use lib64:
	echo installstyle=\"lib"$LIBDIRSUFFIX"/perl5\" >>hints/linux.sh

	./configure.gnu  --prefix=/usr \
   	 	         -Dvendorprefix=/usr \
                         -Dman1dir=/usr/share/man/man1 \
                         -Dman3dir=/usr/share/man/man3 \
               	         -Dpager="/bin/less -isR" \
               	         -Dcc="gcc-lib ${BUILD}"  \
               	         -Dusethreads -Duseshrplib 	
}

pbs_build() {
	domake
}

pbs_install() {
	domkinstall
	
	#cd "$destdir"
	#case $ARCH in 
	#	i?86) 	mv usr/bin/perl{,-32}
	#		mv usr/bin/perl5.14.0{,-32} ;;
	#      x86_64)	mv usr/bin/perl{,-64}
	#		mv usr/bin/perl5.14.0{,-64}
	#		doln /usr/bin/multiarch_wrapper usr/bin/perl
	#		doln /usr/bin/multiarch_wrapper usr/bin/perl5.14.0
	#esac
}


