#
# YLmf_OS package build script
#

DESCRIPTION="Integrated mail, addressbook and calendaring functionality"
HOMEPAGE="http://www.gnome.org/projects/evolution/"
LICENSE="GPLv2"
PACKAGER="Ylmf OS Developers <ylmfos@115.com>"

SRC_URI="http://ftp.gnome.org/pub/gnome/sources/evolution/2.32/"$N-$V".tar.bz2"

RDEPEND="evolution-data-server berkeley-db libnotify gtkhtml nss libical enchant libgnome-keyring eggdbus sqlite krb5 e2fsprogs nspr libsoup gnutls libgcrypt libgpg-error libgnomecanvas gtk+ gail libXi libXcursor libXcomposite libXdamage libXfixes libart_lgpl gnome-desktop gconf orbit libXrandr libXext startup-notification libSM util-linux-ng libICE libunique dbus-glib dbus gtk+ atk glib2 gdk-pixbuf glibc pango cairo pixman libxml2 directfb libpng libxcb libXrender libX11 libxcb libXau libXdmcp fontconfig freetype zlib expat glib2 gdk-pixbuf krb5"
BDEPEND=""
RECOMMENDED=""

INSTALL="$N-$V.install"

pbs_unpack() {
        ypkg_unpack
}

pbs_config() {
	#
	ypkg_patch "$N"-2.32.1-libnotify-0.7.patch

	#  Fix invalid use of la file in contact-editor, upstream bug #635002
	ypkg_patch "$N"-2.32.0-wrong-lafile-usage.patch

	# Fix compilation with --disable-smime, bug #356471
	ypkg_patch "$N"-2.32.2-smime-fix.patch
	           
	# Fix desktop file to work with latest glib
	ypkg_patch "$N"-2.32.2-mime-handler.patch

	# Fix compilation flags crazyness
	sed -e 's/-D.*_DISABLE_DEPRECATED//' -i configure.ac configure

	ypkg_docp_rename "$FILES_PATH"/files/evolution.svg data/icons/hicolor_apps_scalable_evolution.svg
	YPB_CONFIG+=" --disable-schemas-install  
	              --without-kde-applnk-path
		      --enable-plugins=experimental
		      --enable-image-inline
		      --enable-canberra
		      --enable-weather
		      --disable-profiling
		      --disable-pst-import
		      --disable-contacts-map
		      --without-glade-catalog
		      --disable-mono
		      --disable-gtk3
		      --disable-connman"
	intltoolize --force --copy --automake
	ypkg_config
}

pbs_build() {
	ypkg_make
}

pbs_install() {
	ypkg_mkinstall
	
	# keep clean for rarian
	rm -fr "$YPPATH_DEST"/var/lib/scrollkeeper
	rm -fr "$YPPATH_DEST"/var/lib/log
}

