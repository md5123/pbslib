#
# YLmf_OS package build script
#

DESCRIPTION="a productivity suite that is compatible with other major office suites"
HOMEPAGE="http://www.libreoffice.org"
REPO="unusable"
LICENSE="LGPL3"
PACKAGER="Ylmf OS Developers <ylmfos@115.com>"

mirror="http://ftp.kaist.ac.kr/tdf/libreoffice/src/"
mirror_="http://download.go-oo.org/src/"        

SRC_URI="$mirror/libreoffice-libs-extern-sys-"$V$R".tar.bz2
	 $mirror/libreoffice-ure-"$V$R".tar.bz2
	 $mirror/libreoffice-writer-"$V$R".tar.bz2
	 $mirror/libreoffice-translations-"$V$R".tar.bz2
	 $mirror/libreoffice-testing-"$V$R".tar.bz2
	 $mirror/libreoffice-sdk-"$V$R".tar.bz2
	 $mirror/libreoffice-postprocess-"$V$R".tar.bz2
	 $mirror/libreoffice-libs-gui-"$V$R".tar.bz2
	 $mirror/libreoffice-libs-extern-sys-"$V$R".tar.bz2
	 $mirror/libreoffice-libs-extern-"$V$R".tar.bz2
	 $mirror/libreoffice-libs-core-"$V$R".tar.bz2
	 $mirror/libreoffice-impress-"$V$R".tar.bz2
	 $mirror/libreoffice-help-"$V$R".tar.bz2
	 $mirror/libreoffice-filters-"$V$R".tar.bz2
	 $mirror/libreoffice-extras-"$V$R".tar.bz2
	 $mirror/libreoffice-extensions-"$V$R".tar.bz2
	 $mirror/libreoffice-components-"$V$R".tar.bz2
	 $mirror/libreoffice-calc-"$V$R".tar.bz2
	 $mirror/libreoffice-bootstrap-"$V$R".tar.bz2
	 $mirror/libreoffice-base-"$V$R".tar.bz2
	 $mirror/libreoffice-artwork-"$V$R".tar.bz2
	
	 $mirror_/0625a7d661f899a8ce263fc8a9879108-graphite2-0.9.2.tgz
	 $mirror_/067201ea8b126597670b5eff72e1f66c-mythes-1.2.0.tar.gz
	 $mirror_/09357cc74975b01714e00c5899ea1881-pixman-0.12.0.tar.gz
	 $mirror_/0b49ede71c21c0599b0cc19b353a6cb3-README_apache-commons.txt
	 $mirror_/0f63ee487fda8f21fafa767b3c447ac9-ixion-0.2.0.tar.gz
	 $mirror_/128cfc86ed5953e57fe0f5ae98b62c2e-libtextcat-2.2.tar.gz
	 $mirror_/17410483b5b5f267aa18b7e00b65e6e0-hsqldb_1_8_0.zip
	 $mirror_/1756c4fa6c616ae15973c104cd8cb256-Adobe-Core35_AFMs-314.tar.gz
	 $mirror_/185d60944ea767075d27247c3162b3bc-unowinreg.dll
	 $mirror_/18f577b374d60b3c760a3a3350407632-STLport-4.5.tar.gz
	 $mirror_/1f24ab1d39f4a51faf22244c94a6203f-xmlsec1-1.2.14.tar.gz
	 $mirror_/24be19595acad0a2cae931af77a0148a-LICENSE_source-9.0.0.7-bj.html
	 $mirror_/26b3e95ddf3d9c077c480ea45874b3b8-lp_solve_5.5.tar.gz
	 $mirror_/284e768eeda0e2898b0d5bf7e26a016e-raptor-1.4.18.tar.gz
	 $mirror_/2a177023f9ea8ec8bd00837605c5df1b-jakarta-tomcat-5.0.30-src.tar.gz
	 $mirror_/2ae988b339daec234019a7066f96733e-commons-lang-2.3-src.tar.gz
	 $mirror_/2c9b0f83ed5890af02c0df1c1776f39b-commons-httpclient-3.1-src.tar.gz
	 $mirror_/314e582264c36b3735466c522899aa07-icu4c-4_4_2-src.tgz
	 $mirror_/3404ab6b1792ae5f16bbd603bd1e1d03-libformula-1.1.7.zip
	 $mirror_/35c94d2df8893241173de1d16b6034c0-swingExSrc.zip
	 $mirror_/35efabc239af896dfb79be7ebdd6e6b9-gentiumbasic-fonts-1.10.zip
	 $mirror_/37282537d0ed1a087b1c8f050dc812d9-dejavu-fonts-ttf-2.32.zip
	 $mirror_/39bb3fcea1514f1369fcfc87542390fd-sacjava-1.3.zip
	 $mirror_/3ade8cfe7e59ca8e65052644fed9fca4-epm-3.7.tar.gz
	 $mirror_/3bdf40c0d199af31923e900d082ca2dd-libfonts-1.1.6.zip
	 $mirror_/3c219630e4302863a9a83d0efde889db-commons-logging-1.1.1-src.tar.gz
	 $mirror_/451ccf439a36a568653b024534669971-ConvertTextToNumber-1.3.2.oxt
	 $mirror_/47e1edaa44269bc537ae8cabebb0f638-JLanguageTool-1.0.0.tar.bz2
	 $mirror_/48470d662650c3c074e1c3fabbc67bbd-README_source-9.0.0.7-bj.txt
	 $mirror_/48a9f787f43a09c0a9b7b00cd1fddbbf-hyphen-2.7.1.tar.gz
	 $mirror_/48d8169acc35f97e05d8dcdfd45be7f2-lucene-2.3.2.tar.gz
	 $mirror_/4a660ce8466c9df01f19036435425c3a-glibc-2.1.3-stub.tar.gz
	 $mirror_/4ea70ea87b47e92d318d4e7f5b940f47-cairo-1.8.0.tar.gz
	 $mirror_/599dc4cc65a07ee868cf92a667a913d2-xpdf-3.02.tar.gz
	 $mirror_/5ba6a61a2f66dfd5fee8cdd4cd262a37-libwpg-0.2.0.tar.bz2
	 $mirror_/63ddc5116488985e820075e65fbe6aa4-openssl-0.9.8o.tar.gz
	 $mirror_/71474203939fafbe271e1263e61d083e-nss-3.12.8-with-nspr-4.8.6.tar.gz
	 $mirror_/7376930b0d3f3d77a685d94c4a3acda8-STLport-4.5-0119.tar.gz
	 $mirror_/7740a8ec23878a2f50120e1faa2730f2-libxml2-2.7.6.tar.gz
	 $mirror_/798b2ffdc8bcfe7bca2cf92b62caf685-rhino1_5R5.zip
	 $mirror_/7a0dcb3fe1e8c7229ab4fb868b7325e6-mdds_0.5.2.tar.bz2
	 $mirror_/8294d6c42e3553229af9934c5c0ed997-stax-api-1.0-2-sources.jar
	 $mirror_/831126a1ee5af269923cfab6050769fe-mysql-connector-cpp.zip
	 $mirror_/83d4029aebf290c0a9a8fee9c99638d3-libwps-0.2.1.tar.bz2
	 $mirror_/881af2b7dca9b8259abbca00bbbc004d-LinLibertineG-20110101.zip
	 $mirror_/8ce2fcd72becf06c41f7201d15373ed9-librepository-1.1.6.zip
	 $mirror_/8d265a592619166f29c4672ea54812b7-libwpd-0.9.2.tar.bz2
	 $mirror_/90401bca927835b6fbae4a707ed187c8-nlpsolver-0.9.tar.bz2
	 $mirror_/97b2d4dba862397f446b217e2b623e71-libloader-1.1.6.zip
	 $mirror_/9ed97fce60a9a65852402248a6659492-hunspell-1.3.1.tar.gz
	 $mirror_/a169ab152209200a7bad29a275cb0333-seamonkey-1.1.14.source.tar.gz
	 $mirror_/a4d9b30810a434a3ed39fc0003bbd637-LICENSE_stax-api-1.0-2-sources.html
	 $mirror_/a7983f859eafb2677d7ff386a023bc40-xsltml_2.1.2.zip
	 $mirror_/ace6ab49184e329db254e454a010f56d-libxml-1.1.7.zip
	 $mirror_/ada24d37d8d638b3d8a9985e80bc2978-source-9.0.0.7-bj.zip
	 $mirror_/af3c3acf618de6108d65fcdc92b492e1-commons-codec-1.3-src.tar.gz
	 $mirror_/b4cae0700aa1c2aef7eb7f345365e6f1-translate-toolkit-1.8.1.tar.bz2
	 $mirror_/ba2930200c9f019c2d93a8c88c651a0f-flow-engine-0.9.4.zip
	 $mirror_/bc702168a2af16869201dbe91e46ae48-LICENSE_Python-2.6.1
	 $mirror_/bd30e9cf5523cdfc019b94f5e1d7fd19-cppunit-1.12.1.tar.gz
	 $mirror_/c441926f3a552ed3e5b274b62e86af16-STLport-4.0.tar.gz
	 $mirror_/ca4870d899fd7e943ffc310a5421ad4d-liberation-fonts-ttf-1.06.0.20100721.tar.gz
	 $mirror_/ca66e26082cab8bb817185a116db809b-redland-1.0.8.tar.gz
	 $mirror_/d4c4d91ab3a8e52a2e69d48d34ef4df4-core.zip
	 $mirror_/d70951c80dabecc2892c919ff5d07172-db-4.7.25.NC-custom.tar.gz
	 $mirror_/d8bd5eed178db6e2b18eeed243f85aa8-flute-1.1.6.zip
	 $mirror_/db60e4fde8dd6d6807523deb71ee34dc-liblayout-0.2.10.zip
	 $mirror_/dbd5f3b47ed13132f04c685d608a7547-jpeg-6b.tar.gz
	 $mirror_/debc62758716a169df9f62e6ab2bc634-zlib-1.2.3.tar.gz
	 $mirror_/e0707ff896045731ff99e99799606441-README_db-4.7.25.NC-custom.txt
	 $mirror_/e61d0364a30146aaa3001296f853b2b9-libxslt-1.1.26.tar.gz
	 $mirror_/e81c2f0953aa60f8062c05a4673f2be0-Python-2.6.1.tar.bz2
	 $mirror_/ea570af93c284aa9e5621cd563f54f4d-bsh-2.0b1-src.tar.gz
	 $mirror_/ea91f2fb4212a21d708aced277e6e85a-vigra1.4.0.tar.gz
	 $mirror_/ecb2e37e45c9933e2a963cabe03670ab-curl-7.19.7.tar.gz
	 $mirror_/ee8b492592568805593f81f8cdf2a04c-expat-2.0.1.tar.gz
	 $mirror_/eeb2c7ddf0d302fba4bfc6e97eac9624-libbase-1.1.6.zip
	 $mirror_/f02578f5218f217a9f20e9c30e119c6a-boost_1_44_0.tar.bz2
	 $mirror_/f94d9870737518e3b597f9265f4e9803-libserializer-1.1.6.zip
	 $mirror_/fb7ba5c2182be4e73748859967455455-README_stax-api-1.0-2-sources.txt
	 $mirror_/fca8706f2c4619e2fa3f8f42f8fc1e9d-rasqal-0.9.16.tar.gz
	 $mirror_/fdb27bfe2dbe2e7b57ae194d9bf36bab-SampleICC-1.3.2.tar.gz
	 $mirror_/ff369e69ef0f0143beb5626164e87ae2-neon-0.29.5.tar.gz "

RDEPEND=""
BDEPEND=""
RECOMMENDED=""
CONFLICT=""

INSTALL="$N.install"

NOTES="base on:
https://aur.archlinux.org/packages/libreoffice-git/PKGBUILD
http://gitorious.org/chakra-packages/apps/blobs/testing/libreoffice/PKGBUILD"

#DESKTOPFILE="glchess.desktop" or "/opt/test/test.desktop"
#ICONFILE="test.png"   or "/opt/test/test.png"

pbs_config() {
	#
	unset J2REDIR; unset J2SDKDIR; unset JAVA_HOME; unset CLASSPATH; unset EXTRAOPTS
	. /etc/profile.d/jdk.sh
	. /etc/profile.d/jre.sh
	. /etc/profile.d/apache-ant.sh
	#[ -z "${MOZ_PLUGIN_PATH}" ] && . /etc/profile.d/mozilla-common.sh
	
	#
	mkdir -p "$N-$V$R" && cd "$N-$V$R"
	tar xf  "$YPPATH_SOURCE"/libreoffice-bootstrap-"$V$R".tar.bz2
	cd libreoffice-bootstrap-"$V$R"

	SRC_URI=($SRC_URI)
	for i in ${SRC_URI[@]};do
		docp "$YPPATH_SOURCE"/"${i##*/}" src
	done

	#
	config+=""
	./autogen.sh
	doconfig
}

pbs_build() {
	./bootstrap
	domake
}

pbs_install() {
	#domkinstall
	bin/ooinstall -l "$destdir"
	cd ${destdir}
        mkdir -p usr/lib/libreoffice
 	domv basis3.3 CREDITS.odt LICENSE LICENSE.odt program readmes share ure usr/lib/libreoffice
	rm -rfv basis-link
	# move sysui desktop files into place we want to use - javafilter and qstarter, but not unneeded printeradmin
	docp usr/lib/libreoffice/share/xdg/javafilter.desktop \
		  usr/lib/libreoffice/share/xdg/qstart.desktop usr/share/applications/
	# remove version in menu entry and make it visible
	sed -i -e "s/3.3 Quickstarter/Quickstarter/g" usr/share/applications/qstart.desktop
	sed -i -e "/NoDisplay=true/d" 		      usr/share/applications/qstart.desktop
	# remove unneeded .desktop files from vanilla sysui
	rm -rf usr/lib/libreoffice/share/xdg
	# put configuration files into place
	install -dm755 etc/libreoffice
	install -m644  usr/lib/libreoffice/program/{bootstraprc,sofficerc}      etc/libreoffice/
	install -m644  usr/lib/libreoffice/basis3.3/share/psprint/psprint.conf  etc/libreoffice/
	# install dummy links to make them found by LibO
	cd ${destdir}/usr/lib/libreoffice/program/
	ln -vsf /etc/libreoffice/{bootstraprc,sofficerc} .
	cd ${destdir}/usr/lib/libreoffice/basis3.3/share/psprint/
	ln -vsf /etc/libreoffice/psprint.conf .
	#fix http://bugs.archlinux.org/task/17656
	find ${destdir} -perm 444 -exec ls -lh {} \; 
	find ${destdir} -perm 444 -exec chmod 644 {} \;
	find ${destdir} -perm 555 -exec ls -lh {} \;
	find ${destdir} -perm 555 -exec chmod 755 {} \;
	mkdir -p ${destdir}/usr/lib
	cd ${destdir}/usr/lib/
	ln -vsf ${destdir}/usr/lib/libreoffice/ure/lib/libuno_sal.so.3 .
	ln -vsf ${destdir}/usr/lib/libreoffice/basis3.3/program/libsofficeapp.so .
	cd ${destdir}/usr/lib/libreoffice/
	ln -vsf ${destdir}/usr/lib/libreoffice/basis3.3 ./basis-link
	mkdir -p ${destdir}/usr/bin
	cd ${destdir}/usr/bin
	ln -vsf ${pkdir}/usr/lib/libreoffice/program/soffice .
}

