#
# Ylmf OS package build script
#

DESCRIPTION="Media Player for Linux (subversion snapshot and ffmpeg-git)"
HOMEPAGE="http://www.mplayerhq.hu/"
LICENSE="GPL"
PACKAGER="Ylmf OS Developers <ylmfos@ylmf.com>"

# svn checkout svn://svn.mplayerhq.hu/mplayer/trunk mplayer
# and packed by Ylmf OS.
SRC_URI="$N-$V.tar.bz2"

RDEPEND="a52dec aalib alsa-lib attr audiofile bzip2 cyrus-sasl dbus directfb enca esound expat faac faad2 flac fontconfig freetype fribidi gcc-lib giflib glibc jack-audio-connection-kit json-c keyutils krb5 lame lcms libbluray libcap libcdio libdrm libICE libjpeg-turbo libmad libmng libogg libpng libsamplerate libsdl libSM libsndfile libtheora libtool libvdpau libvorbis libX11 libXau libxcb libXdamage libXdmcp libXext libXfixes libXi libXinerama libxml2 libXScrnSaver libXt libXtst libXv libXvMC libXxf86dga libXxf86vm lirc lzo mesa mpg123 nas ncurses openal opencore-amr openldap openssl orc pulseaudio rtmpdump samba schroedinger slang speex talloc util-linux-ng x264 xvidcore zlib"
BDEPEND="libgsm-dev" 
CONFLICT="mplayer"

pbs_unpack() {
	dounpack
}

pbs_config() {
	# It is important to unset CFLAGS. Otherwise build will fail! If it doesn't fail, it will most likely error when run.
	unset CFLAGS
	dopatch ylmfos_auto-download-ffmpeg.patch
	config="--prefix=/usr 
	            --mandir=/usr/share/man 
		    --confdir=/etc/mplayer
		    --language=all
		    --enable-runtime-cpudetection 
		    --enable-xvmc 
		    --enable-menu 
                    --enable-joystick
		    --enable-mga
		    --enable-3dfx
		    --enable-tdfxfb
		    --disable-gui 
		    --disable-arts 
	            --disable-libdvdcss-internal 
		    --disable-dvdread-internal"
	doconfig
}

pbs_build() {
	[ "x$ARCH" = "xi686" ] && sed 's|-march=i486|-march=i686|g' -i config.mak
	domake
}

pbs_install() {
	domkinstall
	docp etc/{codecs.conf,input.conf,example.conf} $filesdir/mplayer.conf  \
		 "$destdir"/etc/mplayer/
	doln /usr/share/fonts/truetype/ttf-dejavu/DejaVuSans.ttf  \
		"$destdir"/usr/share/mplayer/subfont.ttf
}

