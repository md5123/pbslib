#
# StartOS package build script
#
# Copyright 2012 StartOS
# Distributed under the terms of the GNU General Public License v2
#

DESCRIPTION="Toolkit for SSL v2/v3 and TLS v1"
HOMEPAGE="http://www.openssl.org/"
LICENSE="custom:BSD"
PACKAGER="StartOS Developers"

SRC_URI="ftp://ftp.openssl.org/source/"$N-$V"e.tar.gz"

RDEPEND="zlib"
BDEPEND=""

pbs_unpack() {
        dounpack
}

pbs_config() {
	# Avoid conflicts with other man pages
	dopatch fix-manpages.patch
	
	# Remove rpath: http://bugs.archlinux.org/task/14367
	dopatch no-rpath.patch
	
	# Set ca dir to /etc/ssl by default
	dopatch ca-dir.patch
	
	# 
	dopatch makefile-dir.patch
	
	# Mark stack as non-executable: http://bugs.archlinux.org/task/12434
	./config --prefix=/usr --openssldir=/usr/lib/ssl \
	         --libdir=lib shared zlib enable-md2   \
		 -Wa,--noexecstack
}

pbs_build() {
	make depend
	make 
}

pbs_install() {
	make INSTALL_PREFIX="$destdir" MANDIR=/usr/share/man install
	docp certs "$destdir"/etc/ssl/
	dodoc LICENSE
}

