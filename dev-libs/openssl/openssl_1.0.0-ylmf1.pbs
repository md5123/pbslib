#
# YLmf_OS package build script
#

DESCRIPTION="Toolkit for SSL v2/v3 and TLS v1"
HOMEPAGE="http://www.openssl.org/"
LICENSE="custom:BSD"
PACKAGER="Ylmf OS Developers <ylmfos@115.com>"

SRC_URI="ftp://ftp.openssl.org/source/"$N-$V"e.tar.gz"

RDEPEND="glibc zlib"
BDEPEND=""

pbs_unpack() {
        ypkg_unpack
}

pbs_config() {
	# Avoid conflicts with other man pages
	ypkg_patch fix-manpages.patch
	
	# Remove rpath: http://bugs.archlinux.org/task/14367
	ypkg_patch no-rpath.patch
	
	# Set ca dir to /etc/ssl by default
	ypkg_patch ca-dir.patch
	
	# 
	ypkg_patch ylmfos-makefile-dir.patch
	
	# Mark stack as non-executable: http://bugs.archlinux.org/task/12434
	./config --prefix=/usr --openssldir=/usr/lib/ssl \
	         --libdir=lib shared zlib enable-md2   \
		 -Wa,--noexecstack
}

pbs_build() {
	make depend
	make 
}

pbs_install() {
	make INSTALL_PREFIX="$YPPATH_DEST" MANDIR=/usr/share/man install
	ypkg_docp certs "$YPPATH_DEST"/etc/ssl/
	ypkg_dodoc LICENSE
}

