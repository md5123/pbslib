#
# YLmf_OS package build script
#

DESCRIPTION="The Samba package provides file and print services to SMB/CIFS clients and Windows networking to Linux clients"
HOMEPAGE="http://www.samba.org"
REPO=""
LICENSE="GPL-2"
PACKAGER="hzx@115.com"

SRC_URI="http://"$N".org/"$N"/ftp/stable/"$N-$V$R".tar.gz"

RDEPEND="acl attr avahi cups cyrus-sasl dbus e2fsprogs gamin gcc glibc gnutls keyutils krb5 libcap libgcrypt libgpg-error libtasn1 ncurses openldap-client openssl pam popt readline talloc zlib"
BDEPEND="acl-dev attr-dev avahi-dev cups-dev cyrus-sasl-dev dbus-dev e2fsprogs-dev gamin-dev gcc-dev glibc-dev gnutls-dev keyutils-dev krb5-dev libcap-dev libgcrypt-dev libgpg-error-dev libtasn1-dev ncurses-dev openldap-client-dev openssl-dev pam-dev popt-dev readline-dev talloc-dev zlib-dev"
RECOMMENDED=""

NOTES="nobody user and group created automatically."

pbs_unpack() {
        ypkg_unpack
}

pbs_config() {
	cd source3
	YPB_CONFIG+=" --with-piddir=/var/run
		      --with-fhs
		      --with-cifsmount
		      --with-pam
		      --with-pammodulesdir=/lib/security "
	ypkg_config
}

pbs_build() {
	ypkg_make
}

pbs_install() {
	ypkg_mkinstall install-everything
	ypkg_dounit nmbd.service smbd.service winbind.service
	ypkg_docp "$FILES_PATH"/files/smb.conf "$YPPATH_DEST"/etc/samba
}

pbs_postinst() {
	ypkg_groupadd -r "nobody"
	ypkg_useradd -c "nobody users" -d "/dev/null" -s "/bin/false" -r -N "nobody"
}
