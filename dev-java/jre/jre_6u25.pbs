#
# YLmf_OS package build script
#

DESCRIPTION="Sun's java runtime environment"
HOMEPAGE="http://java.sun.com"
LICENSE="custom"
PACKAGER="Ylmf OS Developers <ylmfos@115.com>"

SRC_URI="http://download.java.net/dlj/binaries/jdk-6u25-dlj-linux-i586.bin"

RDEPEND="glibc libXtst"
BDEPEND=""
RECOMMENDED=""
CONFLICT="sun-jre"

INSTALL="$N.install"

pbs_unpack() {
	mkdir -p "$N-$V$R"
	cd "$N-$V$R"
	mkdir -p unbundle-jdk
	cd unbundle-jdk
	sh "$YPPATH_SOURCE"/jdk-6u25-dlj-linux-i586.bin --accept-license
	cd ../
	sh "$FILES_PATH"/files/construct.sh unbundle-jdk linux-jdk linux-jre

}

pbs_install() {
	ypkg_docp linux-jdk/jre "$YPPATH_DEST"/opt/java/
	install -Dm755 "$FILES_PATH"/files/jre.profile "$YPPATH_DEST"/etc/profile.d/jre.sh

	cd "$YPPATH_DEST"
	#if [ "$CARCH" = "i686" ]; then
	ypkg_doln /opt/java/jre/lib/i386/libnpjp2.so usr/lib/mozilla/plugins/libnpjp2.so
	#else ln -s /opt/java/jre/lib/amd64/libnpjp2.so ${pkgdir}/usr/lib/mozilla/plugins
	#fi
	ypkg_docp opt/java/jre/{COPYRIGHT,LICENSE,THIRDPARTYLICENSEREADME.txt}  usr/share/licenses/jre/
	# Fix system prefs folder (FS#18872)
	install -dm755 etc/.java/.systemPrefs
	#
	ypkg_dodesktop "opt/java/jre/lib/desktop/applications/sun-java.desktop" \
	               "opt/java/jre/lib/images/icons/sun-java.png"
}

